```{r}
library(tidyverse)
rm(list = ls())#Clears environment variables
```

Reads in the .csv file which has already been added to the project folder
```{r}
ONP_Original <- read.csv(file = 'OnlineNewsPopularity.csv')
```

Removed Unnecessary Columns
```{r}
ONP_Trimmed <- ONP_Original%>%select(-2:-3,-5:-9,-12:-13,-20:-28,-40:-44)
```

Grouping days of the week into one column for use in lm model. The unite function introduced underscores and zeroes so they were removed using gsub. 
```{r}
ONP_Test <- ONP_Trimmed

ONP_Test$weekday_is_monday <- ONP_Test$weekday_is_monday%>%replace(ONP_Test$weekday_is_monday==1, "Monday")

ONP_Test$weekday_is_tuesday <- ONP_Test$weekday_is_tuesday%>%replace(ONP_Test$weekday_is_tuesday==1, "Tuesday")

ONP_Test$weekday_is_wednesday <- ONP_Test$weekday_is_wednesday%>%replace(ONP_Test$weekday_is_wednesday==1, "Wednesday")

ONP_Test$weekday_is_thursday <- ONP_Test$weekday_is_thursday%>%replace(ONP_Test$weekday_is_thursday==1, "Thursday")

ONP_Test$weekday_is_friday <- ONP_Test$weekday_is_friday%>%replace(ONP_Test$weekday_is_friday==1, "Friday")

ONP_Test$weekday_is_saturday <- ONP_Test$weekday_is_saturday%>%replace(ONP_Test$weekday_is_saturday==1, "Saturday")

ONP_Test$weekday_is_sunday <- ONP_Test$weekday_is_sunday%>%replace(ONP_Test$weekday_is_sunday==1, "Sunday")

ONP_Test <- ONP_Test%>%unite(weekday_is_monday:weekday_is_sunday, col = "day of week", remove = T, sep ="_" )

ONP_Test$`day of week` <- gsub("_", "",ONP_Test$`day of week`)
ONP_Test$`day of week` <- gsub("0", "", ONP_Test$`day of week`)
```

Grouping data channels into one column for use in lm model. The unite function introduced underscores and zeroes so they were removed using gsub.
```{r}
ONP_Test$data_channel_is_lifestyle <- ONP_Test$data_channel_is_lifestyle%>%replace(ONP_Test$data_channel_is_lifestyle==1, "Lifestyle")

ONP_Test$data_channel_is_entertainment <- ONP_Test$data_channel_is_entertainment%>%replace(ONP_Test$data_channel_is_entertainment==1, "Entertainment")

ONP_Test$data_channel_is_bus <- ONP_Test$data_channel_is_bus%>%replace(ONP_Test$data_channel_is_bus==1, "Business")

ONP_Test$data_channel_is_socmed <- ONP_Test$data_channel_is_socmed%>%replace(ONP_Test$data_channel_is_socmed==1, "Social Media")

ONP_Test$data_channel_is_tech <- ONP_Test$data_channel_is_tech%>%replace(ONP_Test$data_channel_is_tech==1, "Technology")

ONP_Test$data_channel_is_world <- ONP_Test$data_channel_is_world%>%replace(ONP_Test$data_channel_is_world==1, "World")

ONP_Test <- ONP_Test%>%unite(data_channel_is_lifestyle:data_channel_is_world, col = "Article_Channel", remove = T, sep ="_" )

ONP_Test$Article_Channel <- gsub("_", "",ONP_Test$Article_Channel)
ONP_Test$Article_Channel <- gsub("0", "", ONP_Test$Article_Channel)
```

Remove rows with blanks in the Article Channel column,Check day of week column for blank rows then rename day of week to "Day_of_Week" 
```{r}
sum(ONP_Test$Article_Channel=="")#counts blanks in Article channel
ONP_Final <- ONP_Test[-which(ONP_Test$Article_Channel == ""), ]#removes rows with blanks
sum(ONP_Test$`day of week`=="")#all rows in Day of Week appear to be populated 
ONP_Final <- rename(ONP_Final, 'Day_of_Week' ='day of week')
```
Sample of df specifically for testing the model to save time
```{r}
df_testing <- ONP_Final[sample(nrow(ONP_Final), 2000), ]
```


```{r}
ONP_Business <- ONP_Trimmed%>%subset(data_channel_is_bus == 1)
```

created histogram to show avg number of shares
```{r}
hist(ONP_Trimmed$self_reference_avg_sharess)
```

histogram to visualize number of words in the articles 
```{r}
hist(ONP_Trimmed$n_tokens_content)
```
```{r}
sapply(ONP_Trimmed, function(x) sum(is.na(x)))
```

```{r}
ONP.lm = lm(formula=shares ~ num_videos + num_imgs + n_tokens_content + rate_positive_words+rate_negative_words+Day_of_Week+Article_Channel, data = ONP_Final)
summary(ONP.lm)
```
```{r}
# ONP.glm = glm(formula=shares ~ num_videos + num_imgs + n_tokens_content + rate_positive_words+rate_negative_words, data = ONP_Trimmed)
# summary(ONP.glm)
# pred_ONP <- predict(ONP.lm, type="response")
# pred_ONP
```


```{r}
ggplot(ONP_Trimmed,aes(num_videos,shares) ) + geom_col(size = 5, alpha = 0.5, color="red")
```
```{r}
ggplot(ONP_Trimmed, aes(num_imgs,shares)) + geom_col(size = 3, colour = "blue",  )
```


lm model with all the variables to see effect on shares
```{r}
#df_Final_1 <- ONP_Final%>%slice(1:10000)
d
```

Creates a new column based on shares, called popularity. If the shares are above 2520.443 the article is considered popular.
```{r}
df_testing$popularity = ifelse(df_testing$shares>2520.443,1,0)
df_testing$popularity <- as.factor(df_testing$popularity)
```


```{r}
set.seed(111)
trainList <- createDataPartition(y=df_testing$popularity, p=.80,list=F)
trainSet <- df_testing[trainList,]
testSet <- df_testing[-trainList,]

#fit1 <- lm(shares ~., trainSet)
svm.model <- train(popularity~Article_Channel+Day_of_Week+n_tokens_content+num_imgs+num_videos, data=trainSet, method="svmRadial", preProc=c("center", "scale"))

#don't run, still need to tweak. 
```


```{r}
validation_set <- df_testing%>%slice(1:10)
validation_set <- validation_set[,-27]
```


```{r}
svmPred <- predict(svm.model, newdata=testSet)
confusion1 <- confusionMatrix(svmPred, testSet$popularity)
confusion1
#svmPred <- predict(svm.model, newdata=validation_set)
svmPred
#svmPred <- predict(svm.model, newdata=testSet)
# confusion <- table(svmPred, validation_set)
# confusion
```

```{r}
ggplot(ONP_Test) + geom_col(aes(x=Article_Channel,y=self_reference_avg_sharess))
```

```{r}
ggplot(ONP_Test) + geom_col(aes(x=(Day_of_Week),y=shares), color='blue')
```

```{r}
set.seed(111)
trainList <- createDataPartition(y=cred$credit_risk, p=.80, list = FALSE)
trainSet <- cred[trainList,]
testSet <- cred[-trainList,]
```

